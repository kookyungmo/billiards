{% extends "foundation/base.html" %} 
{% block header %} 
{% load staticfiles %}
<script type="text/javascript"
	src="http://api.map.baidu.com/api?v=2.0&ak=5aaddbae69513573cd7f693bbdcbe12a"></script>
<script src="{% static "js/moment-with-langs.min.js" %}"></script>
<script language="javascript">var STATIC_URL = "{{ STATIC_URL|escapejs }}";</script>
<script src="{% static "js/map.js" %}?{{buildid}}"></script>
<script src="{% static "js/map_v2.js" %}?{{buildid}}"></script>
<link rel="stylesheet" href="{% static "css/map.css" %}?{{buildid}}">
{% endblock %} 
{% load extras %} 
{% load url from future %} 
{% block content %}
<hr>
<div class="medium-9 columns">
	<div class="panel radius">
		<div class="row">
			<div class="medium-7 medium-push-5 columns">
				<div class="row">
					<div id="baidumap" style="overflow: hidden; margin: 0;"></div>
				</div>
			</div>
			<div class="medium-5 medium-pull-7 columns">
				<div class="show-for-small" align="center">
					<hr>
					{% if match.enrolled %}
					<h3 style="color: #FF9900">已报名。</h3>
					{% else %} <a class="small radius button"
						href="javascript:void(0);" 
					{% if not user.is_authenticated %} 
						data-reveal-id="quickLogin"
		       		{% else %}  
		       			id="enroll" match="{{ match.pk }}"{% endif %}> 我要报名! </a> 
		       		{% endif %}
					<hr>
				</div>
				<h3 style="color: #EB6100">
					<a href="{% url 'poolroom_detail' match.poolroom.id %}">{{ match.poolroom.name }}</a>
				</h3>
				<h3 class="subheader">地址：{{ match.poolroom.address }}</h3>
				<span class="icon_list"> 
					{% if match.poolroom.flags.wifi %} 
						<span class="ico_wifi" title="公共区域WIFI"></span>
					{% endif %}
					{% if match.poolroom.flags.wifi_free %} 
						<span class="ico_free_wifi" title="公共区域WIFI"></span>
					{% endif %}
					{% if match.poolroom.flags.parking or match.poolroom.flags.parking_free %} 
						<span class="ico_parking" title="停车场"></span> 
					{% endif %} 
					{% if match.poolroom.flags.cafeteria %} 
						<span class="ico_restaurant" title="餐饮服务"></span> 
					{% endif %}
					{% if match.poolroom.flags.subway %} 
						<span class="ico_bus" title="地铁周边"></span> 
					{% endif %}
				</span>
				<hr>
				<h3 class="subheader">
					<strong>比赛时间</strong>
				</h3>
				<h5 class="subheader">
					<p>
						<strong><script>document.write(getFormattedTimeToDate('{{ match.starttime|date:"D d M Y, H:i" }}'));</script></strong>
					</p>
				</h5>
				<hr>
				<h3 class="subheader">
					<strong>冠军奖金</strong>
				</h3>
				<h5 class="subheader">
					{% if match.bonus > 0 %}
					<p>
						现金: <strong>{{ match.bonus }}元</strong>
					</p>
					{% elif match.rechargeablecard > 0 %}
					<p>
						俱乐部充值卡: <strong>{{ match.rechargeablecard }}元</strong>
					</p>
					{% elif match.otherprize != None %}
					<p>
						其它奖励: <strong>{{ match.otherprize }}</strong>
					</p>
					{% endif %}
				</h5>
				<hr>
				<h3 class="subheader">
					<strong>报名费</strong>
				</h3>
				<h5 class="subheader">
					<p>{{ match.enrollfee }}</p>
				</h5>
				<hr>
				<h3 class="subheader">
					<strong>报名联系人</strong>
				</h3>
				<h5 class="subheader">
					<p>{{ match.enrollfocal }}</p>
				</h5>
			</div>
		</div>
		<div class="row">
			<hr>
			<h3 class="subheader">
				<strong> 奖金细则</strong>
			</h3>
			<h5 class="subheader">
				<p>{{ match.bonusdetail }}</p>
			</h5>
			<hr>
			<h3 class="subheader">
				<strong>比赛规则</strong>
			</h3>
			<h5 class="subheader">
				<p>{{ match.rule }}</p>
			</h5>
			<h3 class="subheader">
				<strong>备注</strong>
				</h5>
				<h5 class="subheader">
					<p>{{ match.description }}</p>
				</h5>
		</div>
	</div>
</div>
<div class="medium-3 columns hide-for-small">
	<h2 style="color: #FF9900">行动起来!</h2>
	<hr />
	{% if match.enrolled %}
	<h3 style="color: #FF9900">已报名。</h3>
	{% else %} <a class="large button expand" href="javascript:void(0);"
		{% if user.is_authenticated %} id="enroll" match="{{ match.pk }}"
		{% else %} data-reveal-id="quickLogin" {% endif %}> 我要报名! </a> 
	{% endif %}
</div>
{% endblock %} 
{% block script %}
<script>
	var map = new BMap.Map("baidumap");
		$(document).ready(
			function() {
				$("#baidumap").css("height", 250);
			    map.addControl(new BMap.NavigationControl({anchor: BMAP_ANCHOR_TOP_RIGHT, type: BMAP_NAVIGATION_CONTROL_SMALL}));
			    map.enableScrollWheelZoom(true);
			    data = eval(jsonescape('{{ match|matchtojson|safe }}'));
			    point = new BMap.Point(data[0].fields.poolroom.lng,
						data[0].fields.poolroom.lat);
			    map.centerAndZoom(point, 16);
				marker = addMatchMarker(0, point, [data[0]]);
				setTimeout(function(){
					map.panTo(point);
					marker.setAnimation(BMAP_ANIMATION_BOUNCE);
					setTimeout(function(){
						marker.setAnimation(null);
					}, 3000);
				}, 1000);
				$(document).foundation();
				ENROLL_URL = "{% url 'match_enroll' '000' %}";
				$(".hide-for-small #enroll").click(function(){
					matchEnroll($(this).parent(), $(this).attr('match'));
				});
				$(".show-for-small #enroll").click(function(){
					matchEnroll($(this).parent(), $(this).attr('match'));
				});
			});
	</script>
{% endblock %}
