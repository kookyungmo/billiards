{% extends "foundation/base.html" %}
{% block header %}
{% load staticfiles %}
<script src="http://cdnjscn.b0.upaiyun.com/libs/moment.js/2.6.0/moment-with-langs.min.js"></script>
<link href="http://cdnjscn.b0.upaiyun.com/libs/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
<link href="{% static "foundation-icons/foundation-icons.css" %}" rel="stylesheet">
{% endblock %}
{% load extras %}
{% block content %}
<div>
	<div class="clearfix">
		<div class="medium-8 columns">
			<h2 class="fi-calendar">赛事活动日程表</h2>
		</div>
		<div id="viewSwitch" class="medium-4 columns show-for-medium-up">
			<a href="#" class="active list"><i class="fa fa-th-large"></i> 列表</a> 
			<a href="#" class="map"><i class="fa fa-globe"></i> 地图</a>
		</div>
		<div id="calendarSelect" class="large-12 columns">
		</div>
	</div>
	<hr>
	<div id="content">
	</div>
	<div>
		<div id="items"></div>
		<div id="mapContainer" class="hidden medium-9 columns"><div id="pkMap"></div></div>
	</div>
</div>
{% endblock %}
{% block foundationscript %}
{% endblock %}
{% block script %}
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=5aaddbae69513573cd7f693bbdcbe12a"></script>
<script src="{% static "js/map_ui2.js" %}"></script>
<script src="{% static "js/mustache.js" %}?0.8.1"></script>

<script>
var STATIC_URL = "{{ STATIC_URL|escapejs }}";
var MEDIA_URL = "{{ MEDIA_URL }}";

var MATCH_DETAIL_URL = "{% url match_detail '000' %}";
var ACTIVITY_URL = "{% url activity_detail '000' %}";
var ENROLL_URL = "{% url match_enroll '000' %}";
var POOLROOM_URL = "{% url poolroom_detail '000' %}";
var MATCH_URL = "{% url match_map 'map' %}";

var defaultZoom = 12;

var pkMap = new PKMap("pkMap", "北京", defaultZoom);
var pkLocation = new PKLocation(null);
var pkMatches = new PKMatches(pkMap);

var starttime = moment("{{ startdate|date:"D d M Y" }}");
var endtime = moment("{{ enddate|date:"D d M Y" }}");
var bonusobj = eval('{{ bonussummary|safe }}');
var summary = {};
{% for k,v in matchsummary.items %}
summary['{{ k }}'] = {{ v }};
{% endfor %}

pkMatches.buildCalendar(starttime, endtime, bonusobj, summary, {{ intervals }});
matches = eval(jsonescape('{{ matches|matchtojsonwithenroll:user|safe }}'));
pkMatches.layMatches(matches);
pkLocation.consume(
	pkMap.markCurrentLocation,
	pkMatches.updateDistance
);

setUpViewSwitch();

$("dl dd a").click(function() {
	$('#items').html('');
	
	selectedItem = $(this);
	$("dl dd.active").each(function() {
		$(this).removeClass("active");
	});
	selectedItem.parents("dd").attr('class', 'active');
	
	timestamp = selectedItem.attr('timestamp');
	pkMatches.loadMatches(timestamp);
});

	</script>
{% endblock %}
