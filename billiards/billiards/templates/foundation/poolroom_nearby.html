{% extends "foundation/base.html" %}
{% block header %}
{% load staticfiles %}
<script type="text/javascript"
	src="http://api.map.baidu.com/api?v=2.0&ak=5aaddbae69513573cd7f693bbdcbe12a"></script>
<script src="{% static "js/moment-with-langs.min.js" %}"></script>
<script language="javascript">var STATIC_URL = "{{ STATIC_URL|escapejs }}";</script>
<script src="{% static "js/map.js" %}?{{buildid}}"></script>
<script src="{% static "js/map_v2.js" %}?{{buildid}}"></script>
<link rel="stylesheet" href="{% static "css/map.css" %}?{{buildid}}">
{% endblock %}
{% load extras %}
{% block content %}
	<div id="poolroomlist" class="medium-9 medium-offset-1 columns">
		<div class="row">
			<h2>附近<font size = +5><span id="distance">{{defaultDistance}}</span>公里</font>内的球房</h2>
		</div>
		<div class="row">
		<div class="row show-for-medium-up">
			<div id="baidumap"
						style="overflow: auto; margin: 0;"></div>
		</div>
		</div>
		<hr>
		<div class="row">
			<dl class="sub-nav">
				<dt><h3>距离:</h3></dt>
				<dd {% if defaultDistance == 3 %} class="active" {% endif %} distance="3"><h3><a href="javascript:void(0);">3公里</a></h3></dd>
				<dd {% if defaultDistance == 5 %} class="active" {% endif %} distance="5"><h3><a href="javascript:void(0);">5公里</a></h3></dd>
				<dd {% if defaultDistance == 10 %} class="active" {% endif %} distance="10"><h3><a href="javascript:void(0);">10公里</a></h3></dd>
			</dl>
		</div>
		<div id="content" class="row">
			<script type="text/javascript">createInfo("正在获取您的位置...");</script>
		</div>
	</div>
	
<div id="newsfeed" class="large-2 columns">
			<div class="row">
				<div class="large-10 large-centered columns">
					<br>
					<div class="row"><h3><strong>最新球房动态</strong></h3></div>
					<div class="row"><br></div>
					<div class="row"><p>2013年12月22日，“附近的球房”功能第一次内部测试</p></div>
					<div class="row"><br/><br/></div>
				</div>
			</div>
	</div>

{% endblock %}
{% load url from future %} 
{% block script %}
	<script>
	var map = initialMap("baidumap");
	$("#baidumap").css("height", 250);
	map.centerAndZoom('北京',12);
	var mypoint = null;
	NEARBY_URL = "{% url 'poolroom_nearby_point_distance' '00.00' '11.11' '00' %}";
	POOLROOM_URL = "{% url 'poolroom_detail' '000' %}";
	$(document).ready(
			function() {
			    var geolocation = new BMap.Geolocation();
			    geolocation.getCurrentPosition(function(r){
			        if(this.getStatus() == BMAP_STATUS_SUCCESS){
                       	mypoint = r.point;
			            addMyLocation(mypoint);
                       	addCustomToolbar(map, mypoint);
                       	if (map.getBounds().containsPoint(mypoint)) {
			            	map.panTo(mypoint);
                       	}
			            loadingPoolroom('{{ defaultDistance }}', mypoint);
			        }
			        else {
			        	$("#info .subheader").text("无法获取您当前的位置，请刷新页面重试。");
			        }
			    },{enableHighAccuracy: false});
			});
	$("dl dd").click(function() {
		cleanNonLocationMarkers();
		$("#poolroomlist").children("#poolroom").remove();
		$("dl dd[class=active]").removeClass("active");
		$(this).addClass("active");
		distance = $(this).attr("distance");
		$("#distance").text(distance);
		loadingPoolroom(distance, mypoint);
	});
	</script>
{% endblock %}	
