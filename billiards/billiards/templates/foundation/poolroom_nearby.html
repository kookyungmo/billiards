{% extends "foundation/base.html" %}
{% block header %}
<link href="http://cdnjscn.b0.upaiyun.com/libs/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
{% load staticfiles %}
{% endblock %}
{% load extras %}
{% block content %}
	<div>
		<div class="clearfix">
			<div class="large-8 columns">
				<h2>附近<span id="distance">{{defaultDistance}}公里</span>内的球房</h2>
				<div>
					<dl id="distanceSelect" class="sub-nav">
						<dt>距离:</dt>
						<dd {% if defaultDistance == 3 %} class="active" {% endif %} distance="3"><a href="javascript:void(0);">3公里</a></dd>
						<dd {% if defaultDistance == 5 %} class="active" {% endif %} distance="5"><a href="javascript:void(0);">5公里</a></dd>
						<dd {% if defaultDistance == 10 %} class="active" {% endif %} distance="10"><a href="javascript:void(0);">10公里</a></dd>
					</dl>
				</div>
			</div>
			<div id="viewSwitch" class="large-4 columns show-for-medium-up">
				<a href="#" class="active list"><i class="fa fa-th-large"></i> 列表</a> 
				<a href="#" class="map"><i class="fa fa-globe"></i> 地图</a>
			</div>
		</div>
		<hr>
		<div id="content">
		</div>
		<div>
			<div id="poolrooms"></div>
			<div id="mapContainer" class="hidden medium-9 columns"><div id="pkMap"></div></div>
		</div>
	</div>
	
{% endblock %}
{% block foundationscript %}
    <script src="http://cdnjscn.b0.upaiyun.com/libs/foundation/{{FOUNDATION_VER}}/js/foundation/foundation.clearing.min.js"></script>
    <script src="http://cdnjscn.b0.upaiyun.com/libs/foundation/{{FOUNDATION_VER}}/js/foundation/foundation.dropdown.min.js"></script>
{% endblock %}
{% load url from future %} 
{% block script %}

<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=5aaddbae69513573cd7f693bbdcbe12a"></script>
<script src="{% static "js/map_ui2.js" %}?{{buildid}}"></script>
<script src="{% static "js/mustache.js" %}?0.8.1"></script>

<script>
	var STATIC_URL = "{{ STATIC_URL|escapejs }}";
	var MEDIA_URL = "{{ MEDIA_URL }}";

	var NEARBY_URL = "{% url 'poolroom_nearby_point_distance' '00.00' '11.11' '00' %}";
	var POOLROOM_URL = "{% url 'poolroom_detail' '000' %}";

	var defaultZoom = 12;

	createInfo("正在获取您的位置...");

	var pkMap = new PKMap("pkMap", "北京", defaultZoom);
	var pkLocation = new PKLocation(null);
	var pkPoolrooms = new PKPoolrooms(pkMap);
	pkLocation.consume(
		pkMap.markCurrentLocation,
		pkPoolrooms.loadPoolrooms('{{ defaultDistance }}')
	);

	$('#viewSwitch a').click(function() {
		if ($(this).hasClass('active')) {
			return false;
		}
		if ($(this).hasClass('list')) {
			$('#mapContainer').addClass('hidden');
			$('#poolrooms').removeClass('map medium-3 columns').children('.poolroom').addClass('medium-pull-1 medium-offset-1 medium-3');
		} else if ($(this).hasClass('map')) {
			$('#poolrooms').addClass('map medium-3 columns').children('.poolroom').removeClass('medium-pull-1 medium-offset-1 medium-3');	
			$('#mapContainer').removeClass('hidden');
		}

		$(this).addClass('active').siblings().removeClass('active');
		return false;
	});

	$(window).scroll(function() {
		if ($(window).scrollTop() > $('#mapContainer').offset().top) {
			$('#pkMap').css({
				'position': 'fixed',
				'top': 0,
				'width': $('#mapContainer').width()
			});
		} else {
			$('#pkMap').css({
				'position': 'relative'
			});
		}
	});
		
	$("dl dd").click(function() {
		$('#poolrooms').html('');
		$("dl dd[class=active]").removeClass("active");
		$(this).addClass("active");
		distance = $(this).attr("distance");
		$("#distance").text(distance);
		pkPoolrooms.loadPoolrooms(distance)();
	});
</script>
{% endblock %}	
